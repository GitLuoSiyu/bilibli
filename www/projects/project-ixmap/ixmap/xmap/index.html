<!doctype html>
<html>
<head>
	<meta charset="UTF-8" />
	<title> XTileMap </title>
	<script src="../lib/phaser.min.js"></script>
	<script src="../lib/phaser-debug.js"></script>
	<script src="../mylib/phaserex.findpath.js"></script>
	<script src="../mylib/phaserex.fadeandplay.js"></script>
	<script src="xtilemap.js"></script>
	<script src="rolesprite.js"></script>
	<script src="gamemain.js"></script>
	<style>
	body {margin: 0;padding: 0;	}
	canvas {margin: 0 auto;	}
	#gamebox {position: absolute;width: 100%;height: 100%;}
	</style>
</head>
<body>
<div id="gamebox"></div>
<script type="text/javascript">
window.onload = function(){
	var game = new Phaser.Game(800, 450, Phaser.CANVAS, "gamebox");
	game.state.add("boot", Boot);
	game.state.add("loading", Loading);
	game.state.add("menu", Menu);
	game.state.add("main", GameMain);
	game.state.start("boot");
};
function Boot(game){
	this.preload = function() {
		//game.add.plugin(Phaser.Plugin.Debug);
		game.load.spritesheet("loading", "img/loading.png", 80, 24);  
	};
	this.create = function() {
		if(!game.device.desktop){
			this.scale.scaleMode = Phaser.ScaleManager.EXACT_FIT;
		}
		game.state.start("loading");
	}
}
function Loading(game){
	this.preload=function () {
		var loading = game.add.sprite(game.width/2, game.height/2, "loading");
		loading.anchor.setTo(0.5);
		loading.animations.add("loading", [0, 1, 2], 5, true);
		loading.animations.play("loading");

		game.load.spritesheet("nigel", "img/nigel.png", 38, 50);

		game.load.spritesheet("npc-2", "img/npc-2.png", 64, 64);
		game.load.spritesheet("wolf-2", "img/wolf-2.png", 64, 64);

		game.load.spritesheet("mapitems", "img/items.png", 64, 72);

		game.load.image("maptiles", "img/maptiles.png");  
		game.load.tilemap("worldmap", "img/worldmap.json", null, Phaser.Tilemap.TILED_JSON);

		game.load.image("fadeMask", "img/fademask.png");  
	};
	this.create=function () {
		game.state.start("menu");
	};
}
function Menu(game) {
	this.preload=function () {
		game.gameData = {
			maps:[
				{name:"map-0",entries:[[7,14,1,1]]},
				{name:"map-1",entries:[
					[0,8,2,1],[7,0,0,0],[15,12,3,0]
				]},
				{name:"map-2",entries:[
					[10,0,2,0],[15,7,1,0],[11,15,4,1]
				]},
				{name:"map-3",entries:[
					[0,8,1,2],[9,0,3,1],[13,15,3,2]
				]},
				{name:"map-4",entries:[
					[0,11,5,0],[5,0,2,2],[7,15,4,2]
				]},
				{name:"map-5",entries:[
					[15,4,4,0]
				]}
			],
			currMap:0,
			currPos:[7,5],
			currFace:"DOWN",
			items:[]
		};
	};
	this.create = function() {
		var txt = game.add.text((game.width)/2, 200, "点击屏幕开始", {fontSize: "16px", fill: "#fff" });
		txt.anchor.setTo(0.5);  
		game.input.onDown.add(function(){game.state.start("main");}, this);
	};
}

</script>

</body>
</html>